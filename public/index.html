<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ±å°å¯’ (Hua Xiaohan) - Bitcoin Tools</title>
    <meta name="description" content="Professional Ahr999 & Bitcoin DCA Calculator">
    <style>
        :root { --bg: #f8f9fa; --card-bg: #ffffff; --text: #2c3e50; --accent: #3498db; --red: #e74c3c; --green: #2ecc71; --orange: #f39c12; }
        body.dark-mode { --bg: #121212; --card-bg: #1e1e1e; --text: #ecf0f1; --accent: #5dade2; --red: #ff6b6b; --green: #58d68d; --orange: #f5b041; }
        
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; max-width: 640px; margin: 0 auto; background-color: var(--bg); color: var(--text); transition: 0.3s; }
        
        /* é¡¶éƒ¨ Logo å’Œ è®¾ç½®æ  */
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        select { padding: 5px; border-radius: 5px; border: 1px solid #ccc; background: var(--card-bg); color: var(--text); }
        
        /* é¡µé¢åˆ‡æ¢é€‰é¡¹å¡ (æ–°å¢) */
        .tab-nav { display: flex; gap: 20px; margin-bottom: 25px; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 10px; }
        .tab-nav a { text-decoration: none; font-weight: bold; font-size: 16px; }
        .tab-active { color: var(--accent); border-bottom: 3px solid var(--accent); padding-bottom: 7px; }
        .tab-inactive { color: var(--text); opacity: 0.6; }

        .card { background: var(--card-bg); border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        
        .price-val { font-size: 42px; font-weight: 800; letter-spacing: -1px; margin: 5px 0; text-align: center; }
        .indicators-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ind-box { background: rgba(0,0,0,0.03); padding: 15px; border-radius: 12px; text-align: center; }
        .ind-val { font-size: 22px; font-weight: bold; display: block; margin-top: 5px; }
        
        /* è®¡ç®—å™¨å¢å¼º */
        .calc-box { border-left: 4px solid var(--accent); position: relative; }
        .input-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        input[type="number"] { width: 80px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; text-align: center; font-size: 16px; background: var(--card-bg); color: var(--text); }
        
        .result-row { display: flex; justify-content: space-between; align-items: flex-end; padding-top: 15px; border-top: 1px dashed rgba(0,0,0,0.1); }
        .final-amt { font-size: 32px; font-weight: bold; color: var(--accent); }
        
        .freq-badge { font-size: 14px; font-weight: bold; background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        
        /* é¢œè‰² */
        .c-green { color: var(--green); }
        .c-red { color: var(--red); }
        .c-orange { color: var(--orange); }
        
        .footer { text-align: center; margin-top: 40px; font-size: 12px; opacity: 0.6; padding-bottom: 20px; }
        .disclaimer { margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.02); border-radius: 8px; text-align: left; font-size: 11px; line-height: 1.5; border: 1px solid rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div class="nav-bar">
        <div style="font-weight:bold; font-size:18px;">ğŸŒ¸ <span data-i18n="title">Hua Xiaohan</span></div>
        <div>
            <select id="lang-select" onchange="changeLang()">
                <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹é«”</option>
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
            </select>
            <button onclick="toggleTheme()" style="background:none; border:none; cursor:pointer; font-size:16px;">ğŸŒ—</button>
        </div>
    </div>

    <div class="tab-nav">
        <a href="index.html" class="tab-active">ğŸ  <span data-i18n="price">Home</span></a>
        <a href="backtest.html" class="tab-inactive">ğŸ“‰ Backtest (å›æµ‹)</a>
        <span class="tab-inactive" style="opacity:0.3; cursor:not-allowed">ğŸ“’ Ledger (å¾…å¼€å‘)</span>
    </div>

    <div class="card">
        <div style="text-align: center;">
            <span class="label" data-i18n="price" style="font-size:12px; opacity:0.7;">Price</span>
            <div id="price" class="price-val">...</div>
        </div>
        
        <div class="indicators-grid">
            <div class="ind-box">
                <span class="label" data-i18n="ahr_label" style="font-size:12px;">Ahr999</span>
                <span id="ahr-val" class="ind-val">--</span>
                <div id="buy-status" style="font-size:11px; margin-top:5px; font-weight:bold;">--</div>
            </div>
            <div class="ind-box">
                <span class="label" data-i18n="mayer_label" style="font-size:12px;">Sell Indicator</span>
                <span id="mayer-val" class="ind-val">--</span>
                <div id="sell-status" style="font-size:11px; margin-top:5px; font-weight:bold;">--</div>
            </div>
        </div>
    </div>

    <div class="card calc-box">
        <h3 data-i18n="calc_title" style="margin-top:0;">Calculator</h3>
        
        <div class="input-row">
            <span data-i18n="base_amt">Base Amount</span>
            <input type="number" id="base-amount" value="25" oninput="calculate()">
        </div>

        <div style="margin-bottom: 10px;">
            <span data-i18n="freq_label" style="font-size:12px; opacity:0.7;">Frequency:</span>
            <span id="freq-display" class="freq-badge">--</span>
        </div>

        <div class="result-row">
            <div>
                <span id="multiplier-tag" style="background:var(--accent); color:#fff; padding:2px 8px; border-radius:4px; font-size:12px;">x0</span>
            </div>
            <div style="text-align: right;">
                <span data-i18n="buy_this_round" style="display:block; font-size:12px; opacity:0.7;">Invest Today</span>
                <span id="final-amount" class="final-amt">$0</span>
            </div>
        </div>
    </div>

    <div style="text-align: center;">
        <button onclick="fetchData()" style="padding:10px 20px; background:var(--text); color:var(--bg); border:none; border-radius:20px; cursor:pointer;" data-i18n="refresh">Refresh</button>
    </div>

    <div class="footer">
        <div class="disclaimer">
            <strong data-i18n="disclaimer_title">Disclaimer</strong><br>
            <span data-i18n="disclaimer_text">...</span>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        let currentMultiplier = 0;

        async function fetchData() {
            const priceEl = document.getElementById('price');
            priceEl.style.opacity = '0.5';
            
            try {
                const res = await fetch('/api/get-ahr999');
                const data = await res.json();
                
                // 1. åŸºç¡€æ•°æ®
                priceEl.innerText = '$' + data.price.toLocaleString();
                document.getElementById('ahr-val').innerText = data.ahr999;
                document.getElementById('mayer-val').innerText = data.mayer;
                
                // 2. è·å–è¯­è¨€åŒ… (é˜²é”™æœºåˆ¶: å¦‚æœæ‰¾ä¸åˆ°è¯­è¨€åŒ…ï¼Œé»˜è®¤ç”¨è‹±æ–‡)
                let t;
                if (typeof translations !== 'undefined' && translations[currentLang]) {
                    t = translations[currentLang];
                } else {
                    // å¦‚æœ common.js æ²¡åŠ è½½å¥½æˆ–è€…è¯­è¨€åŒ…ç¼ºå¤±ï¼Œä¸´æ—¶å®šä¹‰ä¸€ä¸ªè‹±æ–‡åŒ…é˜²æ­¢æŠ¥é”™
                    t = {
                        status_stop_high: "High Price (Wait)",
                        status_buy_1: "Normal (1x)",
                        status_buy_2: "Value (2x)",
                        status_buy_4: "Cheap (4x)",
                        status_buy_8: "Heavy Buy (8x)",
                        status_buy_16: "Diamond Bottom (16x)",
                        sell_safe: "Safe",
                        sell_elevated: "Warm",
                        sell_high_risk: "High Risk",
                        sell_top_danger: "Top Danger"
                    };
                }

                // 3. çŠ¶æ€æ–‡æœ¬ç¿»è¯‘
                const buyKey = 'status_' + data.buySignal;
                document.getElementById('buy-status').innerText = t[buyKey] || data.buySignal;
                
                const sellKey = 'sell_' + data.sellSignal;
                document.getElementById('sell-status').innerText = t[sellKey] || data.sellSignal;

                // 4. é¢‘ç‡ç¿»è¯‘ (æ–°å¢)
                const freqKey = 'freq_' + data.frequency;
                const freqEl = document.getElementById('freq-display');
                freqEl.innerText = t[freqKey] || data.frequency;
                
                // é¢‘ç‡é¢œè‰²
                if(data.frequency === 'daily') {
                    freqEl.style.color = 'var(--red)';
                    freqEl.style.background = 'rgba(231, 76, 60, 0.1)';
                } else {
                    freqEl.style.color = 'var(--text)';
                    freqEl.style.background = 'rgba(0,0,0,0.05)';
                }

                // 5. é¢œè‰²é€»è¾‘
                const ahrVal = parseFloat(data.ahr999);
                const ahrEl = document.getElementById('ahr-val');
                if(ahrVal < 0.45) ahrEl.className = 'ind-val c-green';
                else if(ahrVal > 1.2) ahrEl.className = 'ind-val c-red';
                else ahrEl.className = 'ind-val';

                const mayerVal = parseFloat(data.mayer);
                const mayerEl = document.getElementById('mayer-val');
                if(mayerVal > 2.4) mayerEl.className = 'ind-val c-red'; 
                else if(mayerVal > 1.8) mayerEl.className = 'ind-val c-orange';
                else mayerEl.className = 'ind-val c-green';

                // 6. è®¡ç®—
                currentMultiplier = data.multiplier;
                document.getElementById('multiplier-tag').innerText = 'x ' + currentMultiplier;
                calculate();

            } catch (err) {
                console.error(err);
                priceEl.innerText = "Error";
            } finally {
                priceEl.style.opacity = '1';
            }
        }

        function calculate() {
            const base = document.getElementById('base-amount').value;
            const total = base * currentMultiplier;
            const finalEl = document.getElementById('final-amount');
            
            finalEl.innerText = '$' + total.toLocaleString();
            
            if(currentMultiplier === 0) {
                finalEl.style.color = '#999';
            } else {
                finalEl.style.color = 'var(--accent)';
            }
        }

        setTimeout(fetchData, 500);
    </script>
</body>
</html>
