<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Dashboard</title>
    <style>
        :root { --bg: #f8f9fa; --card-bg: #ffffff; --text: #2c3e50; --accent: #3498db; --red: #e74c3c; --green: #2ecc71; --orange: #f39c12; }
        body.dark-mode { --bg: #121212; --card-bg: #1e1e1e; --text: #ecf0f1; --accent: #5dade2; --red: #ff6b6b; --green: #58d68d; --orange: #f5b041; }
        body { font-family: -apple-system, sans-serif; margin: 0; background-color: var(--bg); color: var(--text); transition: 0.3s; }
        .container { max-width: 640px; margin: 0 auto; padding: 20px; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        .price-val { font-size: 42px; font-weight: 800; margin: 5px 0; text-align: center; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .box { background: rgba(0,0,0,0.03); padding: 15px; border-radius: 12px; text-align: center; }
        .val { font-size: 22px; font-weight: bold; display: block; margin-top: 5px; }
        input[type="number"] { width: 100px; padding: 8px; border-radius: 6px; border: 1px solid #ddd; text-align: center; font-size: 16px; background: var(--bg); color: var(--text); }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .badge { font-size: 14px; font-weight: bold; background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        .final-amt { font-size: 28px; font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div style="text-align: center;">
                <span style="font-size:12px; opacity:0.7;" data-i18n="price_label">Price</span>
                <div id="price" class="price-val">...</div>
            </div>
            <div class="grid-2">
                <div class="box">
                    <span style="font-size:12px;" data-i18n="ahr_label">Ahr999</span>
                    <span id="ahr-val" class="val">--</span>
                    <div id="buy-status" style="font-size:11px; margin-top:5px; font-weight:bold;">--</div>
                </div>
                <div class="box">
                    <span style="font-size:12px;" data-i18n="mayer_label">Mayer</span>
                    <span id="mayer-val" class="val">--</span>
                    <div id="sell-status" style="font-size:11px; margin-top:5px; font-weight:bold;">--</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0;" data-i18n="calc_title">Calculator</h3>
            <div class="row">
                <span data-i18n="base_amt">Base Amount</span>
                <input type="number" id="base-amount" value="25" oninput="calculate()">
            </div>
            <div style="margin-bottom: 10px;">
                <span style="font-size:12px; opacity:0.7;" data-i18n="invest_freq">Frequency:</span><br>
                <span id="freq-display" class="badge">--</span>
            </div>
            <div class="row" style="border-top: 1px dashed rgba(0,0,0,0.1); padding-top: 15px; align-items: flex-end;">
                <div><span id="multiplier-tag" style="background:var(--accent); color:#fff; padding:2px 8px; border-radius:4px; font-size:12px;">x0</span></div>
                <div style="text-align: right;">
                    <span style="display:block; font-size:12px; opacity:0.7;" data-i18n="invest_today">Invest Today</span>
                    <span id="final-amount" class="final-amt">$0</span>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        let currentMultiplier = 0;
        let globalData = null;

        window.refreshData = function() {
            if(globalData) renderUI(globalData);
            else fetchData();
        }

        async function fetchData() {
            try {
                const res = await fetch('/api/get-ahr999');
                const data = await res.json();
                globalData = data; 
                renderUI(data);
            } catch (err) { console.error(err); }
        }

        function renderUI(data) {
            document.getElementById('price').innerText = formatMoney(data.price);
            document.getElementById('ahr-val').innerText = data.ahr999;
            document.getElementById('mayer-val').innerText = data.mayer;

            // 这里会自动把 "buy_4" 翻译成中文 "抄底区间 (买4份)"
            document.getElementById('buy-status').innerText = getStatusText(data.buySignal);
            document.getElementById('sell-status').innerText = getStatusText(data.sellSignal);
            document.getElementById('freq-display').innerText = getStatusText(data.frequency);

            const ahr = parseFloat(data.ahr999);
            document.getElementById('ahr-val').style.color = ahr < 0.45 ? 'var(--green)' : (ahr > 1.2 ? 'var(--red)' : 'var(--text)');
            
            const mayer = parseFloat(data.mayer);
            document.getElementById('mayer-val').style.color = mayer > 2.4 ? 'var(--red)' : 'var(--green)';

            const freqEl = document.getElementById('freq-display');
            freqEl.style.color = data.frequency === 'daily' ? 'var(--red)' : 'var(--text)';

            currentMultiplier = data.multiplier;
            document.getElementById('multiplier-tag').innerText = 'x ' + currentMultiplier;
            calculate();
        }

        function calculate() {
            const base = parseFloat(document.getElementById('base-amount').value) || 0;
            const total = base * currentMultiplier;
            document.getElementById('final-amount').innerText = formatMoney(total);
        }

        setTimeout(fetchData, 500);
    </script>
</body>
</html>
