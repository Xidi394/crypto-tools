<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>花小寒 - Crypto Dashboard</title>
    <style>
        /* 基础样式变量 */
        :root { --bg: #f8f9fa; --card-bg: #ffffff; --text: #2c3e50; --accent: #3498db; --red: #e74c3c; --green: #2ecc71; }
        body.dark-mode { --bg: #121212; --card-bg: #1e1e1e; --text: #ecf0f1; --accent: #5dade2; --red: #ff6b6b; --green: #58d68d; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 15px; max-width: 640px; margin: 0 auto; background-color: var(--bg); color: var(--text); transition: 0.3s; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); }
        .price-val { font-size: 42px; font-weight: 800; letter-spacing: -1px; margin: 5px 0; text-align: center; }
        .indicators-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ind-box { background: rgba(0,0,0,0.03); padding: 15px; border-radius: 12px; text-align: center; }
        .ind-val { font-size: 22px; font-weight: bold; display: block; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <div style="text-align: center;">
            <span style="font-size:12px; opacity:0.7;">Bitcoin Price</span>
            <div id="price" class="price-val">...</div>
        </div>
        
        <div class="indicators-grid">
            <div class="ind-box">
                <span style="font-size:12px;">Ahr999</span>
                <span id="ahr-val" class="ind-val">--</span>
                <div id="buy-status" style="font-size:11px; margin-top:5px; font-weight:bold;">--</div>
            </div>
            <div class="ind-box">
                <span style="font-size:12px;">Mayer Multiple</span>
                <span id="mayer-val" class="ind-val">--</span>
                <div id="sell-status" style="font-size:11px; margin-top:5px; font-weight:bold;">--</div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // 定义一个刷新数据的函数，common.js 会在切换货币时调用它
        window.refreshData = fetchData;

        async function fetchData() {
            try {
                const res = await fetch('/api/get-ahr999');
                const data = await res.json();
                
                // 【重点】这里使用 common.js 提供的 formatMoney 函数
                // 它会自动根据当前选择的 currency (CNY/JPY) 进行换算
                document.getElementById('price').innerText = formatMoney(data.price);
                
                document.getElementById('ahr-val').innerText = data.ahr999;
                document.getElementById('mayer-val').innerText = data.mayer;
                
                // 简单的颜色逻辑
                const ahr = parseFloat(data.ahr999);
                document.getElementById('ahr-val').style.color = ahr < 0.45 ? 'var(--green)' : (ahr > 1.2 ? 'var(--red)' : 'var(--text)');

                document.getElementById('buy-status').innerText = data.buySignal;
                document.getElementById('sell-status').innerText = data.sellSignal;

            } catch (err) {
                console.error(err);
            }
        }
        
        // 初始加载
        setTimeout(fetchData, 500);
    </script>
</body>
</html>
